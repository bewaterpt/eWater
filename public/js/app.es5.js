"use strict";var _vue=_interopRequireDefault(require("vue")),_laraform=_interopRequireDefault(require("laraform")),_this=void 0;function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function stopSpontaneousSrcolling(){$('a[href="#"]').click(function(e){e.preventDefault()})}require("./bootstrap"),_vue.default.use(_laraform.default),$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}}),stopSpontaneousSrcolling(),require("./config/tinymce/lang/pt_PT"),$('button[type="submit"]').on("click",function(e){return $(e.target).find('button[type="submit"]').attr("disabled",!0),!0}),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){name=this.name.replace(/(\[\])$/,""),e[name]?(e[name].push||(e[name]=[e[name]]),e[name].push(this.value||"")):e[name]=this.value||""}),e},$(function(){$('[data-toggle="popover"]').popover({html:!0,title:function(){return console.log(this),$(document).find("#"+this.id+" .popover").find("#title").html()},content:function(){return $(document).find("#"+this.id+" .popover").find("#content").html()}}),$("[data-onload]").each(function(e,t){customOnload(t,$(t).attr("data-onload"))})}),$(function(){if($("textarea.text-editor").length>0){var e={path_absolute:"/",selector:"textarea.text-editor",language:"pt_PT",menubar:!1,statusbar:!1,plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak","searchreplace visualblocks visualchars code","insertdatetime media nonbreaking table directionality","emoticons template paste textpattern"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media",relative_urls:!1,file_browser_callback:function(t,a,n,r){var o=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,l=e.path_absolute+"laravel-filemanager?field_name="+t;l+="image"==n?"&type=Images":"&type=Files",tinyMCE.activeEditor.windowManager.open({file:l,title:"Filemanager",width:.8*o,height:.8*i,resizable:"yes",close_previous:"no"})}};tinyMCE.init(e),window.mce=tinyMCE.init(e)}}),$(function(){$("table[id^=datatable] tfoot .dt-search").find("select, input").each(function(){$(_this).on("keyup change",function(){!function(e,t,a){var n=this;dataTable=$("#"+e).DataTable(),jQTable=$(e),jQTable.find("tfoot .dt-search").each(function(){dataTable.column($(n).index()).search("")}),dataTable.column(a).search(t).draw()}($(_this).parents("table")[0].id,_this.value,$(_this).parent("td").index())})})}),$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){var t=this.name.replace(/(?=\S)(\[\]$)/,"").replace(/(?=\S)(-)(?<=\S)/,"_");e[t]?(e[t].push||(e[t]=[e[t]]),e[t].push(this.value||"")):e[t]=[this.value||""]}),e},$(function(){var e=setInterval(function(){$("#datatable-users").length>0&&($("#datatable-users").dataTable({responsive:!0,order:[[1,"asc"]],columnDefs:[{targets:$("#datatable-users").find("thead tr:first th.actions").index(),orderable:!1}],language:{url:"/config/dataTables/lang/"+window.lang+".json"}}),clearInterval(e))},1e3)}),$(function(){$("#modalTeamUsers").on("show.bs.modal",function(e){var t="";void 0!==$(e.relatedTarget).data("id")&&(t=$(e.relatedTarget).data("id")),$(e.target).find("#content .body").html(""),$(e.target).find("#modal-spinner").removeClass("d-none"),$currAjax=$.ajax({method:"POST",url:"/teams/get-users",data:JSON.stringify({id:t,raw:!1}),contentType:"json",success:function(t){t=JSON.parse(t),$(e.target).find("#content .body").html(t.content),$(e.target).find("#modal-spinner").addClass("d-none")},error:function(t,a,n){$(e.target).find("#modal-spinner").addClass("d-none"),alert(n)},complete:function(){$(e.target).find("#modal-spinner").addClass("d-none")}})}),""!==$("#teams-colorpicker").find("input").val()?$("#teams-colorpicker").colorpicker({}):$("#teams-colorpicker").colorpicker({color:getRandomVibrantColor(20)})}),$(function(){var e=setInterval(function(){$("#datatable-teams").length>0&&($("#datatable-teams").dataTable({responsive:!0,order:[[1,"asc"]],columnDefs:[{targets:$("#datatable-teams").find("thead tr:first th.actions").index(),orderable:!1}],language:{url:"/config/dataTables/lang/"+window.lang+".json"}}),clearInterval(e))},1e3)}),$(function(){var e='<div class="loading-cpage"><svg id="load" x="0px" y="0px" viewBox="0 0 150 150"><circle id="loading-inner" cx="75" cy="75" r="60"/></svg></div>';$("#datatable-interruptions").length>0&&(window.datatable_calls=$("#datatable-interruptions").DataTable({responsive:!0,searching:!0,order:[[1,"desc"]],columnDefs:[{targets:"sorting-disabled",orderable:!1},{targets:"text-center",className:"text-center"},{targets:"limit-w-35",width:"35%"},{targets:"limit-w-45",width:"45%"},{targets:"limit-w-15",width:"15%"}],lengthChange:!0,language:{paginate:{previous:'<i class="fa fa-angle-left"></i>',next:'<i class="fa fa-angle-right"></i>'},sProcessing:e,sEmptyTable:"No Records",url:"/config/dataTables/lang/"+window.lang+".json"},autoWidth:!1,processing:!0,serverSide:!0,ajax:window.location.pathname,columns:[{data:"actions",name:"actions",class:"actions text-center px-0 sorting-disabled",searchable:!1,sortable:!1},{data:"work_id",name:"work_id",searchable:!0},{data:"start_date",name:"start_date",searchable:!0},{data:"affected_area",name:"affected_area",searchable:!0},{data:"reinstatement_date",name:"reinstatement_date",searchable:!0},{data:"scheduled",name:"scheduled",searchable:!1,calss:"sorting-disabled text-center"}],drawCallback:function(e){this.api().ajax.json()},fnRowCallback:function(e,t,a,n){console.log("Last Index: ",t.trashed),t.trashed&&$("td",e).css("opacity","0.6").css("background-color","#ff717136")}})),$("#datatable-scheduled-interruptions").length>0&&(window.datatable_calls=$("#datatable-shceduled-interruptions").DataTable({responsive:!0,searching:!0,order:[[1,"desc"]],columnDefs:[{targets:"sorting-disabled",orderable:!1}],lengthChange:!0,language:{paginate:{previous:'<i class="fa fa-angle-left"></i>',next:'<i class="fa fa-angle-right"></i>'},sProcessing:e,sEmptyTable:"No Records",url:"/config/dataTables/lang/"+window.lang+".json"},autoWidth:!1,processing:!0,serverSide:!0,ajax:"/interruptions/scheduled",columns:[{data:"actions",name:"actions",class:"actions text-center px-0 sorting-disabled",searchable:!1,sortable:!1},{data:"work_id",name:"work_id",searchable:!0},{data:"start_date",name:"start_date",searchable:!0},{data:"affected_area",name:"affected_area",searchable:!0},{data:"reinstatement_date",name:"reinstatement_date",searchable:!0},{data:"coordinates",name:"coordinates",searchable:!0}],drawCallback:function(e){this.api().ajax.json()}})),$("#datatable-unscheduled-interruptions").length>0&&(window.datatable_calls=$("#datatable-unshceduled-interruptions").DataTable({responsive:!0,searching:!0,order:[[1,"desc"]],columnDefs:[{targets:"sorting-disabled",orderable:!1}],lengthChange:!0,language:{paginate:{previous:'<i class="fa fa-angle-left"></i>',next:'<i class="fa fa-angle-right"></i>'},sProcessing:e,sEmptyTable:"No Records",url:"/config/dataTables/lang/"+window.lang+".json"},autoWidth:!1,processing:!0,serverSide:!0,ajax:"/interruptions/unscheduled",columns:[{data:"actions",name:"actions",class:"actions text-center px-0 sorting-disabled",searchable:!1,sortable:!1},{data:"work_id",name:"work_id",searchable:!0},{data:"start_date",name:"start_date",searchable:!0},{data:"affected_area",name:"affected_area",searchable:!0},{data:"reinstatement_date",name:"reinstatement_date",searchable:!0},{data:"coordinates",name:"coordinates",searchable:!0}],drawCallback:function(e){this.api().ajax.json()}}))}),$(function(){var e={text:$("#fieldText"),select:$("#fieldSelect"),textarea:$("#fieldTextarea"),file:$("#fieldFile"),checkbox:$("#fieldMultiChoice"),radio:$("#fieldUniqueChoice")};console.log($("#remove-field")),$("#create-custom-form").length>0&&($("#add-field a").on("click",function(t){link=$(t.currentTarget),$("#field-container").append(e[link.attr("data-type")].clone(!0))}),$('[id^="field"] a#remove-field').on("click",function(e){link=$(e.currentTarget),console.log(link),link.parents(".field").remove()}),$('[id^="field"] a#insert-option').on("click",function(e){var t=$(e.currentTarget),a=t.siblings("input").val().split(",");$(a).each(function(e,a){t.siblings("select").append('<option value="'+t.siblings("select").find("option").length+'">'+a.trim()+"</option>")}),$(e.currentTarget).siblings("input").val("").trigger("focus")}),$("#create-form").on("submit",function(e){e.preventDefault(),form=e.currentTarget,jQForm=$(e.currentTarget),jQForm.find(".select-field").each(function(e,t){input=$(t).parents(".field").find('input[name="options[]"]'),console.log("Index: ",e),input.val(""),$(t).find("option").each(function(e,a){console.log("Options: ",$(t).find("option")),console.log("Length: ",$(t).find("option").length),console.log(e===$(t).find("option").length-1),e==$(t).find("option").length-1?input.val(input.val()+$(a).text()+":"+a.value):input.val(input.val()+$(a).text()+":"+a.value+",")})});var t=jQForm.serializeObject();console.log("Form Data: ",t),$.ajax({method:"POST",url:"/test",data:JSON.stringify(t),beforeSend:function(e){e.setRequestHeader("Content-type","application/json")}}),console.log(t)}))}),$(function(){if($("#settings-permissions").length>0){$("#settings-permissions").on("submit",function(e){e.preventDefault(),$(e.target).find('button[type="submit"]').find("#spinner, #spinner-text").removeClass("d-none"),$(e.target).find('button[type="submit"]').find(".btn-text").addClass("d-none");var t=[];$("#settings-permissions .permission-value .square.green").each(function(e){if($(this).prop("checked")){var a=((n=(n=$(this).attr("name")).split("]["))[0]=n[0].replace("[",""),n[1]=n[1].replace("]",""),{id:n[0],route:n[1]});t.push({id:a.id,route:a.route})}var n}),function(e,t){$.ajax({url:window.origin+"/permissions/update",method:"POST",data:JSON.stringify({data:e}),dataType:"json"}).done(function(e){$(t.target).find('button[type="submit"]').find("#spinner, #spinner-text").addClass("d-none"),$(t.target).find('button[type="submit"]').find(".btn-text").removeClass("d-none")})}(t,e)})}}),$(function(){$(".multiselect-listbox").length>0&&($(".multiselect-listbox #btnContainer #addItems").on("click",function(e){e.preventDefault(),console.log(e.target),$(e.target).closest(".multiselect-listbox").find("#selectLeft").find(":selected").appendTo($(e.target).closest(".multiselect-listbox").find("#selectRight")[0]).prop("selected",!1),$(e.target).closest(".multiselect-listbox").find("#selectLeft").find(":selected").remove()}),$(".multiselect-listbox #btnContainer #removeItems").on("click",function(e){e.preventDefault(),console.log(e.target),$(e.target).closest(".multiselect-listbox").find("#selectRight").find(":selected").appendTo($(e.target).closest(".multiselect-listbox").find("#selectLeft")[0]).prop("selected",!1),$(e.target).closest(".multiselect-listbox").find("#selectRight").find(":selected").remove()}));var e=$($(".multiselect-listbox")[0]).parent("form");console.log(e),e.on("submit",function(t){t.preventDefault(),e.find(".multiselect-listbox").each(function(t,a){e.find("input#"+$(a).attr("data-field")).val(""),$(a).find("#selectRight option").each(function(t,n){t===$(a).find("#selectRight option").length-1?e.find("input#"+$(a).attr("data-field")).val(e.find("input#"+$(a).attr("data-field")).val()+n.value):e.find("input#"+$(a).attr("data-field")).val(e.find("input#"+$(a).attr("data-field")).val()+n.value+", ")})}),e[0].submit()})}),$(function(){$("a[data-toggle='tooltip']").tooltip({html:!0})}),$(function(){var e=!1,t=new Date;if($("#daily-reports-create").length>0&&""===$("#inputDatetime").val()&&$("#inputDatetime").val(ISODateString(t)).attr("max",ISODateString(t)),$("#daily-reports-create").length>0||$("#daily-reports-edit").length>0){var a=function(e){$(e.target).closest("tr").remove()},n=function(e){$(e.target).closest(".card.work:not(#original-work)").remove()},r=function(e){var t=$(e.target).parents(".card.work").find("table#report-lines tbody tr:last-child").clone();console.log(t),t.find("input").val("").prop("readonly",!1),t.find(':not(td:first-child) input[type="number"]').val(0),t.removeClass("first"),t.find("#removeRow").on("click",function(e){a(e)}),t.find("#info").tooltip({html:!0,title:function(){return $(document).find("#"+this.id+"-tooltip .tooltip").find("#title").html()}}),console.log(t[0]),$(e.target).parents(".card.work").find("table#report-lines tbody").append(t),$('a[href="#"]').on("click",function(e){e.preventDefault()})},o=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];clearAjaxErrors();var n={plate:$('input[name="plate"]').val(),km_departure:$('input[name="km-departure"]').val(),km_arrival:$('input[name="km-arrival"]').val(),comment:$("textarea").val(),datetime:$("#inputDatetime").val(),team:$("#inputTeam").children("option:selected").val()},r=$("div.card.work input.work-number").map(function(e,t){return t.value}).get();if(new Date(n.datetime)>t)throw new Error($("#errors #invalidDate").text());if($("[data-error=true]").length>0||r.indexOf("0")>-1)throw new Error($("#errors #invalidWorkNumber").text());a&&(n.id=$("#reportId").text());var o=n.km_arrival-n.km_departure,i=0,l={};if($("div.card.work").each(function(e,t){console.log("Work: ",t);var a=$(t).find("input.work-number").val();if(0===a)throw new Error($("#errors #unexpectedError"));l[a]={},$(t).find("tbody tr").each(function(e,n){l[a][e]={},l[a][e].driven_km=$(t).find("input.driven-km").val(),$(n).find("input:not(.work-number), select").each(function(t,n){"driven_km"!==n.name&&("quantity"===n.name?l[a][e][n.name]=parseFloat(parseFloat(n.value).toFixed(2)):l[a][e][n.name]=n.value)})})}),$(document).find(".card.work .card-header input[name=driven_km]").each(function(e,t){i+=parseInt(t.value)}),console.log("Total: ",o),console.log("Inserted: ",i),console.log(Math.abs(i-o)),i-o<0&&0==e)throw e=!0,new Error($("#errors #inferiorKm").text());if(i-o>0)throw new Error($("#errors #superiorKm").text());if(i-o<0&&$("#inputComment").val().length<15)throw new Error($("#errors #inferiorKmWarn").text());n.rows=l,window.createOrEditReportRequest&&4!==window.createOrEditReportRequest.readyState||(window.createOrEditReportRequest=$.ajax({method:"POST",url:$("#report").attr("action"),data:JSON.stringify(n),contentType:"json",success:function(e){$('button[type="submit"]').find("#spinner, #spinner-text").addClass("d-none"),$('#report button[type="submit"]').find(".btn-text").removeClass("d-none"),window.location.replace(e)},error:function(e,t,a){if(console.log(a),e.responseJSON.exception)throw logAjaxError(a),new Error(a.message);console.log(e.responseJSON),processAjaxErrors(e.responseJSON.errors),console.log(t),$('button[type="submit"]').find("#spinner, #spinner-text").addClass("d-none"),$('#report button[type="submit"]').find(".btn-text").removeClass("d-none")},complete:function(){$('button[type="submit"]').find("#spinner, #spinner-text").addClass("d-none"),$('button[type="submit"]').find(".btn-text").removeClass("d-none")}}))};setInterval(function(){var e=0,t=$('input[name="km-arrival"]').val()-$('input[name="km-departure"]').val();$(document).find(".card.work .card-header input[name=driven_km]").each(function(t,a){e+=parseInt(a.value)}),e-t<0?($("#warnings #superiorKmErr").addClass("d-none"),$("#warnings #inferiorKmWarn").removeClass("d-none")):e-t>0?($("#warnings #inferiorKmWarn").addClass("d-none"),$("#warnings #superiorKmErr").removeClass("d-none")):($("#warnings #superiorKmErr").addClass("d-none"),$("#warnings #inferiorKmWarn").addClass("d-none"))},1e3),$("#addRow").on("click",function(e){r(e)}),$("a.remove-work").on("click",function(e){n(e)}),$("a#removeRow").on("click",function(e){a(e)}),$("a.add-work").on("click",function(e){console.log("Target: ",e.target);var t=$(e.target).parents(".card").find(".work").last().clone();t.removeAttr("id");var a=t.find("table#report-lines tbody tr");a.each(function(e,t){if(a.length-(e+1)==0)return!1;$(t).remove()}),t.find("#addRow").on("click",function(e){r(e)}),console.log("Work: ",t),t.find("a.remove-work").on("click",function(e){n(e)});var o=t.find("table#report-lines tbody tr:last-child");o.find("input").val("").prop("readonly",!1),o.find(':not(td:first-child) input[type="number"]').val(0),o.removeClass("first"),o.find("#removeRow").on("click",function(e){removeLine(e)}),o.find("#info").tooltip({html:!0,title:function(){return $(document).find("#"+this.id+"-tooltip .tooltip").find("#title").html()}}),$(t).find("input.work-number").on("keydown keyup change",function(e){}),$(e.target).parents(".card").find(".work").last().after(t),$('a[href="#"]').click(function(e){e.preventDefault()})}),$(".info-tooltip").tooltip({html:!0,title:function(){return $(document).find("#"+this.id+"-tooltip .tooltip").find("#title").html()}}),$("div.card.work input.work-number").on("keyup",function(e){}),$("#report").on("submit",function(e){e.preventDefault(),e.stopPropagation(),$('button[type="submit"]').find("#spinner, #spinner-text").removeClass("d-none"),$('button[type="submit"]').find(".btn-text").addClass("d-none");try{$("#daily-reports-edit").length>0?o(!0):o()}catch(e){return $('button[type="submit"]').find("#spinner, #spinner-text").addClass("d-none"),$('button[type="submit"]').find(".btn-text").removeClass("d-none"),void alert(e.message)}}),$(document).on("change keyup",'input[name="km-departure"], input[name="km-arrival"]',function(e){$("#total-km-holder #value").text(parseInt($('input[name="km-arrival"]').val()-$('input[name="km-departure"]').val())),parseInt($('input[name="km-arrival"]').val()-$('input[name="km-departure"]').val())<0?$("#total-km-holder").addClass("text-danger"):$("#total-km-holder").removeClass("text-danger")}),$(document).on("change keyup",'input[name="quantity"]',function(e){console.log("Fired");var t=0;$('input[name="quantity"]').each(function(e,a){t+=parseFloat($(a).val())||0}),t>0&&$("#total-hour-holder").find("#value").text(decimalToTimeValue(parseFloat(t).toFixed(2))),parseInt($('input[name="km-arrival"]').val()-$('input[name="km-departure"]').val())<0?$("#total-km-holder").addClass("text-danger"):$("#total-km-holder").removeClass("text-danger")})}$("#daily-reports-view").length>0&&$("#modalComment").on("show.bs.modal",function(e){var t="";void 0!==$(e.relatedTarget).data("id")&&(t=$(e.relatedTarget).data("id")),$(e.target).find("#content .body").html(""),$(e.target).find("#modal-spinner").removeClass("d-none"),$currAjax=$.ajax({method:"POST",url:"/daily-reports/process-status/get-comment",data:JSON.stringify({id:t}),contentType:"json",success:function(t){t=JSON.parse(t),$(e.target).find("#content .body").html(t.content),$(e.target).find("#modal-spinner").addClass("d-none")},error:function(t,a,n){$(e.target).find("#modal-spinner").addClass("d-none"),alert(n)},complete:function(){$(e.target).find("#modal-spinner").addClass("d-none")}})}),$("#cancel-report").on("click",function(e){e.preventDefault(),confirm($("#prompts .cancel-report").text())&&window.location.replace($(e.currentTarget).attr("href"))})}),$(function(){if($("#report-process-status").length>0&&$("#report-process-status").DataTable({responsive:!0,order:[[3,"desc"]],searching:!1,lengthChange:!1,language:{url:"/config/dataTables/lang/"+window.lang+".json"}}),$("#datatable-reports").length>0){var e;window.datatable_reports=$("#datatable-reports").DataTable((_defineProperty(e={responsive:!0,searching:!0,order:[[1,"desc"]],columnDefs:[{targets:"sorting-disabled",orderable:!1}]},"searching",!0),_defineProperty(e,"bFilter",!1),_defineProperty(e,"columnDefs",[{targets:"sorting-disabled",orderable:!1}]),_defineProperty(e,"lengthChange",!0),_defineProperty(e,"language",{paginate:{previous:'<i class="fa fa-angle-left"></i>',next:'<i class="fa fa-angle-right"></i>'},sProcessing:loadingHTML,sEmptyTable:"No Records",url:"/config/dataTables/lang/"+window.lang+".json"}),_defineProperty(e,"autoWidth",!1),_defineProperty(e,"processing",!0),_defineProperty(e,"serverSide",!0),_defineProperty(e,"ajax","/daily-reports"),_defineProperty(e,"columns",[{data:"actions",name:"actions",class:"actions text-center px-0 sorting_disabled",searchable:!1,sortable:!1},{data:"id",name:"id",searchable:!0},{data:"status",name:"status",searchable:!1},{data:"quantity",name:"quantity",searchable:!1},{data:"driven_km",name:"driven_km",searchable:!0},{data:"team",name:"team",searchable:!0},{data:"entry_date",name:"entry_date",searchable:!0},{data:"info",name:"info",searchable:!1}]),_defineProperty(e,"drawCallback",function(e){}),e));var t=null;$("#datatable-reports").find("thead .filter-col").each(function(e,a){$(a).on("change keyup",function(n){window.datatable_reports.column(e).search($(a).is("select")?$(a).find("option:selected").val():a.value),clearTimeout(t),t=setTimeout(function(){window.datatable_reports.draw()},500)})})}});var _require=require("tinymce"),triggerSave=_require.triggerSave;function getmonthlyWaitTimeInfo(){return new Promise(function(e,t){window.monthlyWaitTimeInfoAjax=$.ajax({method:"POST",url:"/calls/get_monthly_wait_time_info",contentType:"json",data:JSON.stringify(queryData),success:function(t){chartData=JSON.parse(t),window.monthlyWaitTimeInfoChart.data={labels:chartData.labels,datasets:[{label:$("#labels #maxMonthlyWaitTime").text(),data:chartData.max,backgroundColor:"rgba(43, 132, 99, 0.2)",borderColor:"rgba(43, 132, 99, 0.2)",borderWidth:1},{label:$("#labels #averageMonthlyWaitTime").text(),data:chartData.avg,backgroundColor:"rgba(43, 34, 200, 0.2)",borderColor:"rgba(43, 34, 200, 1)",borderWidth:1,type:"line",fill:!1},{label:$("#labels #weightedAverageMonthlyWaitTime").text(),data:chartData.wavg,backgroundColor:"rgba(200, 34, 43, 0.2)",borderColor:"rgba(200, 34, 43, 1)",borderWidth:1,type:"line",fill:!1}]},window.monthlyWaitTimeInfoChart.update(),e(!0)},error:function(e,a,n){t(n.message)}})})}function getMonthlyCallVolume(){return new Promise(function(e,t){window.monthlyCallNumberAjax=$.ajax({method:"POST",url:"/calls/get_monthly_call_number_info",contentType:"json",data:JSON.stringify(queryData),success:function(t){chartData=JSON.parse(t),window.monthlyCallNumberInfoChart.data={labels:chartData.labels,datasets:[{label:$("#labels #monthlyTotalCalls").text(),data:chartData.total,backgroundColor:"rgba(43, 132, 99, 0.2)",borderColor:"rgba(43, 132, 99, 0.2)",borderWidth:1},{label:$("#labels #monthlyFrontOfficeCalls").text(),data:chartData.frontOffice,backgroundColor:"rgba(43, 34, 200, 0.2)",borderColor:"rgba(43, 34, 200, 1)",borderWidth:1,type:"line",fill:!1},{label:$("#labels #monthlyGenericCalls").text(),data:chartData.generic,backgroundColor:"rgba(200, 34, 43, 0.2)",borderColor:"rgba(200, 34, 43, 1)",borderWidth:1,type:"line",fill:!1},{label:$("#labels #monthlyInternalCalls").text(),data:chartData.internal,backgroundColor:"rgba(200, 34, 140, 0.2)",borderColor:"rgba(200, 34, 140, 1)",borderWidth:1,type:"line",fill:!1}]},window.monthlyCallNumberInfoChart.update(),window.monthlyLostCallNumberInfoChart.data={labels:chartData.labels,datasets:[{label:$("#labels #monthlyTotalLostCalls").text(),data:chartData.totalLost,backgroundColor:"rgba(43, 132, 99, 0.2)",borderColor:"rgba(43, 132, 99, 0.2)",borderWidth:1},{label:$("#labels #monthlyFrontOfficeLostCalls").text(),data:chartData.frontOfficeLost,backgroundColor:"rgba(43, 34, 200, 0.2)",borderColor:"rgba(43, 34, 200, 1)",borderWidth:1,type:"line",fill:!1},{label:$("#labels #monthlyGenericLostCalls").text(),data:chartData.genericLost,backgroundColor:"rgba(200, 34, 43, 0.2)",borderColor:"rgba(200, 34, 43, 1)",borderWidth:1,type:"line",fill:!1},{label:$("#labels #monthlyInternalLostCalls").text(),data:chartData.internalLost,backgroundColor:"rgba(200, 34, 140, 0.2)",borderColor:"rgba(200, 34, 140, 1)",borderWidth:1,type:"line",fill:!1}]},window.monthlyLostCallNumberInfoChart.update(),e(!0)},error:function(e,a,n){t(n.message)}})})}$(function(){if($("#calls-pbx-create").length>0&&$("#calls-pbx-create .show-password").on("mousedown mouseup",function(e){"password"===$(e.target).parent("a").siblings("input").attr("type")?$(e.target).parent("a").siblings("input").attr("type","text"):$(e.target).parent("a").siblings("input").attr("type","password")}),$("#calls-dashboard").length>0){var e=$("#monthlyWaitTimeInfo")[0].getContext("2d"),t=$("#monthlyCallNumberInfo")[0].getContext("2d"),a=$("#monthlyLostCallNumberInfo")[0].getContext("2d");queryData={inbound:!1,dates:!1},window.monthlyWaitTimeInfoChart=new Chart(e,{type:"bar",options:{title:{display:!0,text:$("#titles #minMaxExternalMonthlyWaitTime").text()},scales:{yAxes:[{ticks:{beginAtZero:!0,userCallback:function(e){return decimalSecondsToTimeValue(e)}}}]}}}),window.monthlyCallNumberInfoChart=new Chart(t,{type:"bar",options:{title:{display:!0,text:$("#titles #totalCallsByTypeAndMonthExcludeLost").text()},scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}}),window.monthlyLostCallNumberInfoChart=new Chart(a,{type:"bar",options:{title:{display:!0,text:$("#titles #totalLostCallsByTypeAndMonth").text()},scales:{yAxes:[{ticks:{beginAtZero:!0}}]}}}),getmonthlyWaitTimeInfo().catch(function(e){alert(e)}),getMonthlyCallVolume().catch(function(e){alert(e)}),$("#export a").on("click",function(){$.ajax({method:"GET",url:$(this).attr("href"),dataType:"json",success:function(e,t,a){var n=a.getResponseHeader("content-disposition"),r=/"([^"]*)"/.exec(n),o=null!=r&&r[1]?r[1]:a.getResponseHeader("X-ewater-filename"),i=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=document.createElement("a");l.href=window.URL.createObjectURL(i),l.download=o,document.body.appendChild(l),l.click(),document.body.removeChild(l),$("#modalSpinner").modal("hide")}})}),$("#refetchCallData").on("click",function(e){$(e.currentTarget).attr("data-disabled")||$.ajax({url:"/calls/refetch",success:function(e){200===(e=JSON.parse(e)).status?(window.datatable_calls.draw(),getmonthlyWaitTimeInfo().catch(function(e){alert(e)}),getMonthlyCallVolume().catch(function(e){alert(e)})):alert(e.message),$("#modalSpinner").modal("hide")},error:function(e){console.log(e),alert(e.responseText)}})}),$("#clearDate").on("click",function(e){console.log(e.currentTarget),""!=$(e.currentTarget).siblings("input").val()&&($(e.currentTarget).tooltip({html:!0}),$(e.currentTarget).siblings("input").val("").trigger("change"))});var n=!1,r=setInterval(function(){console.log(n),$.ajax({url:"check-call-record-update-state",method:"GET",dataType:"json",headers:{"Access-Control-Allow-Origin":"localhost"},success:function(e){console.log(e),1===parseInt(e.updating)?($("#refetchCallData").addClass("spining").attr("data-disabled",!0),0!==parseInt(e.current)&&($("#cdrUpdateState").removeClass("d-none").addClass("d-inline"),$("#cdrUpdateState .current").text(e.current),$("#cdrUpdateState .total").text(e.total)),n=!0):($("#cdrUpdateState").addClass("d-none").removeClass("d-inline"),$("#refetchCallData").removeClass("disabled spining").removeAttr("data-disabled").tooltip("dispose"),n&&(window.datatable_calls.draw(),getmonthlyWaitTimeInfo().catch(function(e){alert(e)}),getMonthlyCallVolume().catch(function(e){alert(e)}),n=!1))},error:function(e){clearInterval(r)}})},2e3)}});var loadingHTML='<div class="loading-cpage"><svg id="load" x="0px" y="0px" viewBox="0 0 150 150"><circle id="loading-inner" cx="75" cy="75" r="60"/></svg></div>';$(function(){if($("#datatable-pbx").length>0&&$("#datatable-pbx").DataTable({responsive:!0,order:[[1,"desc"]],columnDefs:[{targets:"actions",orderable:!1}],lengthChange:!0,language:{url:"/config/dataTables/lang/"+window.lang+".json"}}),$("#datatable-calls").length>0){var e;window.datatable_calls=$("#datatable-calls").DataTable((_defineProperty(e={responsive:!0,searching:!0,order:[[0,"desc"]],bFilter:!1,columnDefs:[{targets:"sorting-disabled",orderable:!1}],lengthChange:!0,language:{paginate:{previous:'<i class="fa fa-angle-left"></i>',next:'<i class="fa fa-angle-right"></i>'},sProcessing:loadingHTML,sEmptyTable:"No Records",url:"/config/dataTables/lang/"+window.lang+".json"},autoWidth:!1,processing:!0,serverSide:!0,ajax:"/calls",columns:[{data:"timestart",name:"timestart",searchable:!0},{data:"callfrom",name:"callfrom",searchable:!0},{data:"callto",name:"callto",searchable:!0},{data:"callduration",name:"callduration",searchable:!0},{data:"talkduration",name:"talkduration",searchable:!0},{data:"waitduration",name:"waitduration",searchable:!0},{data:"status",name:"status",searchable:!0},{data:"type",name:"type",searchable:!0}]},"language",{url:"/config/dataTables/lang/"+window.lang+".json"}),_defineProperty(e,"drawCallback",function(e){this.api().ajax.json()}),e));var t=null;$("#datatable-calls").find("thead .filter-col").each(function(e,a){$(a).on("change keyup",function(n){console.log(e),console.log(n.target),window.datatable_calls.column(e).search($(a).is("select")?$(a).find("option:selected").val():a.value),clearTimeout(t),t=setTimeout(function(){window.datatable_calls.draw()},500)})})}}),$(function(){var e=setInterval(function(){$("#datatable-roles").length>0&&($("#datatable-roles").dataTable({responsive:!0,order:[[1,"asc"]],columnDefs:[{targets:$("#datatable-roles").find("thead tr:first th.actions").index(),orderable:!1}],language:{url:"/config/dataTables/lang/"+window.lang+".json"}}),clearInterval(e))},1e3)});
